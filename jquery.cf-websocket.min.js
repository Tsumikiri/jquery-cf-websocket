'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}(function(a){var b={url:'ws://localhost:8579/cfusion',messageDefaults:{ns:'coldfusion.websocket.channels',appName:'MyApplicationName',customOptions:{}}},c=function(){function c(a,b){_classCallCheck(this,c);var d='object'===('undefined'==typeof b?'undefined':_typeof(b))&&b.constructor===Object;this.channelHandlers=d?b:{},this.eventHandlers={},this.w=this.i(a,d?Object.keys(b).join(','):b)}return _createClass(c,[{key:'i',value:function i(a,b){var c=this,d=arguments,e=new WebSocket(a);return e.onopen=function(){c.s('welcome',void 0,void 0,{subscribeTo:b}),c.f('open',d)},e.onclose=function(){c.f('close',d)},e.onmessage=function(a){var b=a.data?JSON.parse(a.data):{};0>b.code?c.f('error',[a,b]):'data'===b.type?c.f('data',b.channelname&&b.channelname in c.channelHandlers?b.channelname:void 0,[a,'data'in b&&b.data?JSON.parse(b.data):{},b]):'subscribeTo'===b.reqType?b.channelssubscribedto?c.f('subscribe',[a,b]):c.f('error',[a,b]):b.reqType?c.f(b.reqType,[a,b]):c.f('error',[a,b]),c.f('message',[a,b])},e.onerror=function(){c.f('error',d)},e}},{key:'f',value:function f(a,b,c){void 0===c&&(c=b,b=void 0),b&&'data'===a?this.channelHandlers[b].apply(this,c):a in this.eventHandlers&&this.eventHandlers[a].apply(this,c)}},{key:'s',value:function s(c,d,e,f){this.w.send(JSON.stringify(a.extend(!0,{},b.messageDefaults,{type:c,channel:d,customOptions:e},f)))}},{key:'send',value:function send(a){return'object'===('undefined'==typeof a?'undefined':_typeof(a))&&channels.constructor===Object||Array.isArray(a)?this.w.send(JSON.stringify(a)):this.w.send(a),this}},{key:'close',value:function close(a,b){return this.w.close(a,b),this}},{key:'getSubscriberCount',value:function getSubscriberCount(a,b){return this.s('getSubscriberCount',a),b&&(this.eventHandlers.getSubscriberCount=b),this}},{key:'getSubscriptions',value:function getSubscriptions(a){return this.s('getSubscriptions'),a&&(this.eventHandlers.getSubscriptions=a),this}},{key:'isConnectionOpen',value:function isConnectionOpen(){return 1===this.w.readyState}},{key:'openConnection',value:function openConnection(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.url;return this.isConnectionOpen()||(this.w=this.i(a)),this}},{key:'closeConnection',value:function closeConnection(){return this.close()}},{key:'subscribe',value:function subscribe(a,b,c){return this.s('subscribe',a,b),c&&(this.channelHandlers[a]=c),this}},{key:'unsubscribe',value:function unsubscribe(a){return this.s('unsubscribe',a),this}},{key:'publish',value:function publish(a,b,c){return this.s('publish',a,c,{data:b}),this}},{key:'authenticate',value:function authenticate(a,b){return this.s('authenticate',void 0,void 0,{username:a,password:b}),this}},{key:'on',value:function on(a,b){return this.eventHandlers[a]=b,this}},{key:'binaryType',get:function get(){return this.w.binaryType},set:function set(a){this.w.binaryType=a}},{key:'bufferedAmount',get:function get(){return this.w.bufferedAmount}},{key:'extensions',get:function get(){return this.w.extensions},set:function set(a){this.w.extensions=a}},{key:'onclose',get:function get(){return this.eventHandlers.close},set:function set(a){this.eventHandlers.close=a}},{key:'onerror',get:function get(){return this.eventHandlers.error},set:function set(a){this.eventHandlers.error=a}},{key:'onmessage',get:function get(){return this.eventHandlers.message},set:function set(a){this.eventHandlers.message=a}},{key:'onopen',get:function get(){return this.eventHandlers.open},set:function set(a){this.eventHandlers.open=a}},{key:'protocol',get:function get(){return this.w.protocol},set:function set(a){this.w.protocol=a}},{key:'readyState',get:function get(){return this.w.readyState}},{key:'url',get:function get(){return this.w.url}}]),c}();a.ws=function(b,d){var e=new c(a.ws.config.url,b);return a.isPlainObject(d)?e.eventHandlers=d:'function'==typeof d&&(e.eventHandlers.data=d),e},a.ws.config=b})(jQuery);
