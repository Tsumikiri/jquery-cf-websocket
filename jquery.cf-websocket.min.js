'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}(function(a){var b={url:('https'===window.location.protocol?'wss://':'ws://')+window.location.hostname+('madrid.truth.com'===window.location.hostname?':8579/cfusion/cfusion':'/cfws'),messageDefaults:{ns:'coldfusion.websocket.channels',appName:'ATApps'+('testapps.amesburytruth.com'===window.location.hostname?'Test':''),customOptions:{authKey:Cookies.get('authkey')}}},c=function(){function c(a,b,d,e){_classCallCheck(this,c);var f='object'===('undefined'==typeof b?'undefined':_typeof(b))&&b.constructor===Object;this.channelHandlers=f?b:{},this.eventHandlers={},this.oneHandlers={},this.w=this.i(a,f?Object.keys(b).join(','):b,e)}return _createClass(c,[{key:'c',value:function c(a,b){var c='open'===a&&this.readyState===WebSocket.OPEN?this.o:'close'===a&&this.readyState===WebSocket.CLOSED?this.c:void 0;c&&(b?b.apply(this,c):this.oneHandlers[a].pop().apply(this,c))}},{key:'i',value:function i(a,b,c){var d=this,e=arguments,f=new WebSocket(a);return f.onopen=function(){d.s('welcome',void 0,void 0,{subscribeTo:b,customOptions:c}),d.o=e,d.f('open',e)},f.onclose=function(){d.c=e,d.f('close',e)},f.onmessage=function(a){var b=a.data?JSON.parse(a.data):{};if(b.data)try{b.data=JSON.parse(b.data)}catch(a){}b.code?d.f('error',[a,b]):'data'===b.type?d.f('data',b.channelname&&b.channelname in d.channelHandlers?b.channelname:void 0,[a,'data'in b&&b.data?b.data:{},b]):'subscribeTo'===b.reqType?b.channelssubscribedto?d.f('subscribe',[a,b]):d.f('error',[a,b]):b.reqType?d.f(b.reqType,[a,b]):d.f('error',[a,b]),d.f('message',[a,b])},f.onerror=function(){d.f('error',e)},f}},{key:'f',value:function f(a,b,c){void 0===c&&(c=b,b=void 0),b&&'data'===a?this.channelHandlers[b].apply(this,c):a in this.oneHandlers&&0<this.oneHandlers[a].length?this.oneHandlers[a].shift().apply(this,c):a in this.eventHandlers&&this.eventHandlers[a].apply(this,c)}},{key:'s',value:function s(c,d,e,f){this.w.send(JSON.stringify(a.extend(!0,{},b.messageDefaults,{type:c,channel:d,customOptions:e},f)))}},{key:'send',value:function send(a){return'object'===('undefined'==typeof a?'undefined':_typeof(a))&&channels.constructor===Object||Array.isArray(a)?this.w.send(JSON.stringify(a)):this.w.send(a),this}},{key:'close',value:function close(a,b){return this.w.close(a,b),this}},{key:'getSubscriberCount',value:function getSubscriberCount(a,b){return this.s('getSubscriberCount',a),b&&this.one('getSubscriberCount',b),this}},{key:'getSubscriptions',value:function getSubscriptions(a){return this.s('getSubscriptions'),a&&this.one('getSubscriptions',a),this}},{key:'isConnectionOpen',value:function isConnectionOpen(){return 1===this.w.readyState}},{key:'openConnection',value:function openConnection(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.url;return this.isConnectionOpen()||(this.w=this.i(a)),this}},{key:'closeConnection',value:function closeConnection(){return this.close()}},{key:'subscribe',value:function subscribe(a,b,c){return this.s('subscribe',a,b),c&&(this.channelHandlers[a]=c),this}},{key:'unsubscribe',value:function unsubscribe(a){return this.s('unsubscribe',a),this}},{key:'publish',value:function publish(a,b,c){try{b=JSON.stringify(b)}catch(a){}return this.s('publish',a,c,{data:b}),this}},{key:'authenticate',value:function authenticate(a,b,c){return this.s('authenticate',void 0,void 0,{username:a,password:b}),c&&this.one('authenticate',c),this}},{key:'on',value:function on(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return'data'===a&&1<c.length?this.channelHandlers[c[0]]=c[1]:0<c.length&&(this.eventHandlers[a]=c[c.length-1]),this.c(a,c[c.length-1]),this}},{key:'one',value:function one(a,b){return this.oneHandlers[a]?this.oneHandlers[a].push(b):this.oneHandlers[a]=[b],this.c(a),this}},{key:'binaryType',get:function get(){return this.w.binaryType},set:function set(a){this.w.binaryType=a}},{key:'bufferedAmount',get:function get(){return this.w.bufferedAmount}},{key:'extensions',get:function get(){return this.w.extensions},set:function set(a){this.w.extensions=a}},{key:'onclose',get:function get(){return this.eventHandlers.close},set:function set(a){this.eventHandlers.close=a}},{key:'onerror',get:function get(){return this.eventHandlers.error},set:function set(a){this.eventHandlers.error=a}},{key:'onmessage',get:function get(){return this.eventHandlers.message},set:function set(a){this.eventHandlers.message=a}},{key:'onopen',get:function get(){return this.eventHandlers.open},set:function set(a){this.eventHandlers.open=a}},{key:'protocol',get:function get(){return this.w.protocol},set:function set(a){this.w.protocol=a}},{key:'readyState',get:function get(){return this.w.readyState}},{key:'url',get:function get(){return this.w.url}}]),c}();a.ws=function(b){var d='function'==typeof(1>=arguments.length?void 0:arguments[1]),e=new c(a.ws.config.url,b,void 0,d?2>=arguments.length?void 0:arguments[2]:1>=arguments.length?void 0:arguments[1]);return d&&(e.eventHandlers.data=1>=arguments.length?void 0:arguments[1]),e},a.ws.config=b})(jQuery);
